---
title: "hw-03"
author: "Beth (S2852258)"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
## **DO NOT EDIT THIS CODE CHUNK**
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(tidymodels)
```


## Data load and preparation before modelling

```{r read_data}
gss16<-read.csv("data/gss16.csv")
```

#### Cleaning and selecting columns

```{r}
gss16_advfront <- gss16 %>%
  select(advfront, emailhr, educ, polviews, wrkstat) %>%
  drop_na()
```

#### Re-levelling `advfront`

```{r}
gss16_advfront <- gss16_advfront %>%
  mutate(
    advfront = case_when(
      advfront == "Strongly agree" ~ "Agree",
      advfront == "Agree" ~ "Agree",
      TRUE ~ "Not agree"
    ),
    advfront = fct_relevel(advfront, "Not agree", "Agree")
  )
```

#### Re-levelling `polviews`

```{r}
gss16_advfront <- gss16_advfront %>%
  mutate(
    polviews = case_when(
      str_detect(polviews, "[Cc]onservative") ~ "Conservative",
      str_detect(polviews, "[Ll]iberal") ~ "Liberal",
      TRUE ~ polviews
    ),
    polviews = fct_relevel(polviews, "Conservative", "Moderate", "Liberal")
  )
```


## Exercise 1: Create a linear regression model

#### Exercise 1 (a)

```{r}
gss16_linear <- linear_reg() %>%
  set_engine("lm")%>%
  fit(emailhr ~ educ, data = gss16_advfront)

tidy(gss16_linear)
```

*Line of best fit formula: Å· = -2.76 + 0.69x. This means that the estimate for the mean value of educ is -2.07*

#### Exercise 1 (b)

```{r}
glance(gss16_linear)

ggplot(data = gss16_advfront,
       mapping = aes( x = educ,
                      y = emailhr)) +
  geom_point()+
  geom_smooth(method = lm, se = FALSE)

```

*The model is not suitable, as the data is not continious, but discrete. There is also no clear trend within the plot, as the data is very far spread from the line of best fit. Furthermore the r squared value is *

## Exercise 2: Create a workflow to fit a model

```{r split-data}
set.seed(1234)
gss16_split <- initial_split(gss16_advfront)
gss16_train <- training(gss16_split)
gss16_test  <- testing(gss16_split)
```

#### Exercise 2 (a)

```{r}
gss16_rec_1 <- recipe(advfront ~ educ, data = gss16_train)
  
gss16_mod_1 <- logistic_reg() %>%
  set_engine("glm")

gss16_wflow_1 <- workflow() %>%
  add_model(gss16_mod_1) %>%
  add_recipe(gss16_rec_1)
```

*Your answer here*

#### Exercise 2 (b)

```{r}
# I chose a logistic model, as the data is categorical, and so a linear model is not suitable.
```

*Your answer here*

#### Exercise 2 (c)

```{r}
gss16_fit_1 <- gss16_wflow_1 %>%
  fit(data = gss16_train)

gss16_fit_1 %>%
  tidy()
```

*Your answer here*

## Exercise 3: Logistic regression with single predictor

#### Exercise 3 (a)

```{r}
gss16_pred <- predict(gss16_fit_1, gss16_test, type = "prob") %>%
  bind_cols(gss16_test %>% select (advfront, educ))

gss16_pred

gss16_pred %>%
  roc_curve(
    truth = advfront,
    .pred_Agree,
    event_level = "second"
  ) %>%
  autoplot()
```

*Your answer here*

#### Exercise 3 (b)

```{r}
cutoff_prob <- 0.83
cutoff_table <- gss16_pred %>%
  mutate(
    advfront_pred = if_else(.pred_Agree > cutoff_prob, "Predicted Agree", "Predicted Disagree")  
    ) %>%
      count(advfront_pred, advfront) %>%
      pivot_wider(names_from = advfront, values_from = n)

cutoff_table

#sensitivity = 1 - False Negative Rate
#specificity = 1 - False Positive Rate
#False Negative Rate = False Negative/(True Positive + False Negative)
#False Positive Rate = False Positive/(False Positive + True Negative)

```

*sensitivity = 1 - (18/(147+18))/293 = 0.99963, specificity = 1 - (10/(10+118))/293 = 0.99973*

## Exercise 4: Logistic regression modelling and interpretation

#### Exercise 4 (a)

```{r}
gss16_rec_2 <- recipe(advfront ~ polviews, wrkstate, emailhr, educ, data = gss16_train) %>%
  step_dummy(all_nominal(), -all_outcomes()) 
  
  
gss16_mod_2 <- logistic_reg() %>%
  set_engine("glm")

gss16_wflow_2 <- workflow() %>%
  add_model(gss16_mod_2) %>%
  add_recipe(gss16_rec_2)

```

*Your answer here*

#### Exercise 4 (b)
  
```{r}
gss16_fit_2 <- gss16_wflow_2 %>%
  fit(data = gss16_train)

gss16_fit_2 %>%
  tidy()

gss16_pred_2 <- predict(gss16_fit_2, gss16_test, type = "prob") %>%
  bind_cols(gss16_test %>% select (advfront, educ, polviews, wrkstat, emailhr))

gss16_pred_2

gss16_pred_2 %>%
  roc_curve(
    truth = advfront,
    .pred_Agree,
    event_level = "second"
  ) %>%
  autoplot()
```

*Your answer here*

#### Exercise 4 (c) 

```{r}
# replace this with your code
```

*Your answer here*

